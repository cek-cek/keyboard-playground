#!/bin/bash
# SessionStart hook for keyboard-playground
# This hook automatically sets up the Flutter environment when a new session starts

set -e

echo "üéØ Keyboard Playground Session Setup"
echo ""

# Check if Flutter is already available
if command -v flutter &> /dev/null; then
    echo "‚úì Flutter is already available in PATH"
    flutter --version | head -n 1
else
    echo "‚öôÔ∏è  Flutter not found in PATH, running setup..."
    echo ""

    # Run the setup script
    cd /home/user/keyboard-playground
    ./.claude/setup.sh
fi

# Ensure Flutter is in PATH for the session
if [ -d "/opt/flutter/bin" ]; then
    export PATH="/opt/flutter/bin:$PATH"
elif [ -d "$HOME/flutter/bin" ]; then
    export PATH="$HOME/flutter/bin:$PATH"
fi

# Quick environment check
echo ""
echo "üìä Environment Status:"
echo "  Flutter version: $(flutter --version 2>/dev/null | head -n 1 || echo 'Not available')"
echo "  Project: keyboard-playground"
echo "  Working directory: $(pwd)"
echo ""
echo "üí° Quick commands (Makefile auto-handles Flutter PATH):"
echo "  ‚Ä¢ make test      - Run all tests"
echo "  ‚Ä¢ make analyze   - Run static analysis"
echo "  ‚Ä¢ make ci        - Run all CI checks (format + analyze + test)"
echo "  ‚Ä¢ make setup     - Re-run Flutter setup if needed"
echo ""
echo "‚ö†Ô∏è  IMPORTANT: Pre-push hook enforces 'make ci' before pushing"
echo "   All pushes are blocked unless format, analyze, and tests pass"
echo ""
echo "üìö For more info: See .claude/TESTING.md"
echo ""
